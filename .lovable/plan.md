
# خطة التحسينات الشاملة

## ملخص التغييرات المطلوبة

1. **السلة**: إضافة زر "اذهب إلى صفحة الطباخة" + زر "تأكيد الطلب" (يتطلب تسجيل دخول)
2. **صفحة الطباخ العامة**: إضافة زر (+) لإضافة الأطباق للسلة
3. **إرسال الطلب للطباخ**: عند تأكيد الطلب يُرسل للطباخ في قاعدة البيانات
4. **تغيير أسماء الأزرار**: "تسوق الآن" → "تسوق الطعام" | "ارفع طبخاتك" → "مطبخي"
5. **تحسين checkbox الشروط والأحكام** في صفحة التسجيل
6. **حذف جميع المستخدمين** من قاعدة البيانات (99 مستخدم حالياً)

---

## التفاصيل التقنية

### 1. تعديل صفحة السلة (Cart.tsx)

**التغييرات:**
- إبقاء زر "اذهب إلى صفحة الطباخة" لكل مجموعة
- إضافة زر **"تأكيد الطلب"** لكل مجموعة طباخ
- التحقق من تسجيل الدخول قبل تأكيد الطلب
- عند الضغط على "تأكيد الطلب":
  - إذا غير مسجل → توجيه لصفحة تسجيل الدخول
  - إذا مسجل → إرسال الطلب لجدول `orders` و `order_items`
- بعد إرسال الطلب بنجاح → إظهار رسالة نجاح ومسح عناصر هذا الطباخ من السلة

**الكود المضاف:**
```text
- استيراد useAuth للتحقق من تسجيل الدخول
- دالة handleConfirmOrder(merchantId, items, total)
- زر "تأكيد الطلب" بجانب زر "اذهب لصفحة الطباخة"
```

### 2. تعديل صفحة الطباخ العامة (PublicPage.tsx)

**التغييرات:**
- إضافة زر (+) أخضر على كل طبق لإضافته للسلة
- استخدام hook `useCart` لإضافة العناصر
- إظهار toast عند الإضافة

**الكود المضاف:**
```text
- استيراد useCart و toast
- تمرير merchant_slug للسلة
- زر Plus على كل بطاقة طبق
```

### 3. تغيير أسماء الأزرار

**الملف:** `src/hooks/useLanguage.tsx`

| المفتاح | القيمة القديمة | القيمة الجديدة |
|---------|---------------|----------------|
| `index.shopNow` | تسوق الآن | تسوق الطعام |
| (تم بالفعل) `index.myKitchen` | - | مطبخي |

### 4. تحسين checkbox الشروط والأحكام

**الملف:** `src/pages/Auth.tsx`

**التغييرات:**
- جعل النص أوضح وأكبر قليلاً
- إضافة أيقونة ✓ عند الموافقة
- تحسين التباين اللوني

### 5. حذف جميع المستخدمين من قاعدة البيانات

**ملاحظة هامة:** هذا الإجراء لا يمكن التراجع عنه!

**خطوات الحذف:**
1. حذف جميع البيانات المرتبطة أولاً:
   - `order_items` (عناصر الطلبات)
   - `orders` (الطلبات)
   - `item_images` (صور الأطباق)
   - `items` (الأطباق)
   - `gallery_images` (صور المعرض)
   - `payment_receipts` (وصولات الدفع)
   - `terms_agreements` (موافقات الشروط)
   - `subscriptions` (الاشتراكات)
   - `user_roles` (صلاحيات المستخدمين)
   - `customer_profiles` (ملفات العملاء)
   - `profiles` (ملفات الطباخين)
2. حذف المستخدمين من `auth.users` (يتطلب صلاحيات service role)

**سأستخدم Edge Function لحذف المستخدمين لأن ذلك يتطلب service_role**

---

## ملخص الملفات المعدلة

| الملف | نوع التغيير |
|-------|-------------|
| `src/pages/Cart.tsx` | إضافة زر تأكيد الطلب + منطق الإرسال |
| `src/pages/PublicPage.tsx` | إضافة زر (+) للسلة |
| `src/hooks/useLanguage.tsx` | تغيير "تسوق الآن" → "تسوق الطعام" |
| `src/pages/Auth.tsx` | تحسين checkbox الشروط |
| `supabase/functions/admin-data/index.ts` | إضافة وظيفة حذف جميع المستخدمين |

---

## الترجمات الجديدة المطلوبة

```text
'cart.confirmOrder': { ar: 'تأكيد الطلب', en: 'Confirm Order' }
'cart.orderConfirmed': { ar: 'تم تأكيد الطلب', en: 'Order Confirmed' }
'cart.orderSentToMerchant': { ar: 'تم إرسال طلبك للطباخ وسيتواصل معك قريباً', en: 'Your order was sent to the cook and they will contact you soon' }
'cart.loginToConfirm': { ar: 'سجل دخولك لتأكيد الطلب', en: 'Login to confirm order' }
'public.addToCart': { ar: 'أضف للسلة', en: 'Add to Cart' }
```

---

## النتيجة المتوقعة

1. **العميل يتصفح** صفحة الطباخ → يضغط (+) لإضافة أطباق للسلة
2. **العميل يذهب للسلة** → يرى:
   - زر "اذهب لصفحة الطباخة" (للتواصل)
   - زر "تأكيد الطلب" (يتطلب تسجيل دخول)
3. **عند تأكيد الطلب** → يُرسل للطباخ ويظهر في لوحة تحكمه
4. **قاعدة البيانات نظيفة** → كل المستخدمين السابقين محذوفين

---

## تحذير هام

**حذف المستخدمين لا يمكن التراجع عنه!** سيتم حذف:
- 99 حساب مستخدم
- جميع الأطباق والصور والطلبات المرتبطة

هل تريد المتابعة؟
