

# خطة التعديلات المطلوبة

## 1. تكبير الشعار في الصفحة الرئيسية
تغيير عرض الشعار من 120px إلى حوالي 180px في صفحة Index.tsx.

## 2. إظهار زر لوحة الأدمن فقط للأرقام المحددة
بدلاً من إظهار زر "لوحة الأدمن" لجميع المستخدمين، سيتم التحقق من رقم هاتف المستخدم المسجل. إذا كان الرقم من ضمن القائمة المحددة فقط يظهر الزر:
- +962796830150
- +962795666185
- +962799126390

التعديلات:
- في Header.tsx: جلب رقم هاتف المستخدم من جدول profiles أو customer_profiles
- إظهار زر الأدمن فقط إذا تطابق الرقم مع أحد الأرقام المحددة
- إزالة إمكانية الوصول للأدمن عبر كلمة المرور لغير هذه الأرقام

## 3. نظام الإشعارات

### قاعدة البيانات
إنشاء جدول `notifications` يحتوي على:
- id, user_id, title, message, type (order, rating, system), is_read, created_at

### لوحة الأدمن
- إضافة تبويب "الإشعارات" في صفحة Admin
- عرض إشعارات الطلبات الجديدة والتقييمات الجديدة
- عداد الإشعارات غير المقروءة

### لوحة تحكم الطباخة (Dashboard)
- إضافة أيقونة جرس الإشعارات في الهيدر
- عرض إشعارات الطلبات الجديدة والتقييمات
- عداد الإشعارات غير المقروءة

## 4. نظام التقييمات

### قاعدة البيانات
إنشاء جدول `ratings` يحتوي على:
- id, merchant_id (uuid), customer_id (uuid, nullable), customer_name (varchar), rating (integer 1-5), comment (text, nullable), created_at

### صفحة الطباخة العامة (PublicPage.tsx)
- عرض متوسط التقييم وعدد التقييمات بجانب اسم الطباخة (نجوم)
- إضافة قسم "التقييمات" أسفل المنتجات
- نموذج لإضافة تقييم جديد (اسم + نجوم + تعليق اختياري)

### لوحة الأدمن (Admin.tsx)
- إضافة تبويب "التقييمات" لعرض جميع التقييمات مع إمكانية الحذف

### لوحة تحكم الطباخة (Dashboard.tsx)
- إضافة تبويب "التقييمات" لعرض تقييمات الطباخة الخاصة بها

## التفاصيل التقنية

### الملفات المتأثرة

| الملف | نوع التغيير |
|-------|-------------|
| `src/pages/Index.tsx` | تعديل - تكبير الشعار |
| `src/components/Header.tsx` | تعديل - إظهار الأدمن حسب الرقم فقط |
| `src/pages/Admin.tsx` | تعديل - إضافة تبويب الإشعارات والتقييمات |
| `src/pages/Dashboard.tsx` | تعديل - إضافة تبويب التقييمات + جرس الإشعارات |
| `src/pages/PublicPage.tsx` | تعديل - عرض التقييمات ونموذج الإضافة |
| `supabase/functions/admin-data/index.ts` | تعديل - دعم جلب/حذف التقييمات |
| Migration SQL | إنشاء جداول notifications و ratings مع سياسات RLS |

### جدول ratings - سياسات RLS
- SELECT: الجميع يمكنهم قراءة التقييمات (عامة)
- INSERT: أي مستخدم مسجل أو زائر (بدون تسجيل) يمكنه إضافة تقييم
- DELETE: الأدمن فقط عبر edge function

### جدول notifications - سياسات RLS
- SELECT: المستخدم يرى إشعاراته فقط
- UPDATE: المستخدم يمكنه تحديث حالة القراءة لإشعاراته
- INSERT: عبر trigger أو edge function فقط

### آلية الإشعارات
- عند إنشاء طلب جديد: إنشاء إشعار للطباخة
- عند إضافة تقييم جديد: إنشاء إشعار للطباخة وللأدمن
- استخدام database trigger لإنشاء الإشعارات تلقائياً

### التحقق من رقم الأدمن في Header
- جلب رقم الهاتف من profiles (إذا merchant) أو customer_profiles (إذا customer)
- مقارنة الرقم بعد تنظيفه مع القائمة المحددة
- الأرقام المسموحة: 962796830150, 962795666185, 962799126390

